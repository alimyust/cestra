<?xml version="1.0"?>
<robot name="cestra_swerve" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:include filename="$(find cestra_description)/urdf/swerve/swerve_properties.xacro"/>
  <xacro:include filename="$(find cestra_description)/urdf/inertial_macros.xacro" />
  <xacro:include filename="$(find cestra_description)/urdf/swerve_wheel.xacro"/>
  <!-- Parameters -->
  <xacro:property name="base_height" value="0.05"/>
  <xacro:property name="base_length" value="0.3"/>
  <xacro:property name="base_width" value="0.3"/>
  <xacro:property name="wheel_radius" value="0.05"/>
  <xacro:property name="wheel_width" value="0.02"/>
  <xacro:property name="steer_link_height" value="0.05"/>

  <!-- Chassis -->
  <link name="base_link"> </link>

  <link name="chassis">
    <visual>
        <origin xyz="${base_height} 0 ${base_height/2}" rpy="0 0 0"/>
        <geometry>
            <box size="${base_length} ${base_width} ${base_height}"/>
        </geometry>
        <material name="white"/>
    </visual>

    <collision>
        <origin xyz="${base_height} 0 ${base_height/2}" rpy="0 0 0"/>
        <geometry>
            <box size="${base_length} ${base_width} ${base_height}"/>
        </geometry>
    </collision>

    <xacro:inertial_box mass="0.5" x="${base_length}" y="${base_width}" z="${base_height}">
      <origin xyz="${base_height} 0 ${base_height/2}" rpy="0 0 0"/>
    </xacro:inertial_box>
  </link>

  
  <joint name="chassis_joint" type="fixed">
      <parent link="base_link"/>
      <child link="chassis"/>
      <origin xyz="-0.1 0 0"/>
  </joint>

  
  <xacro:swerve_module name="front_left" xyz="${base_length/2} ${base_width/2} 0"/>
  <xacro:swerve_module name="front_right" xyz="${base_length/2} -${base_width/2} 0"/>
  <xacro:swerve_module name="rear_left" xyz="-${base_length/2} ${base_width/2} 0"/>
  <xacro:swerve_module name="rear_right" xyz="-${base_length/2} -${base_width/2} 0"/>
  
  <gazebo>
    <plugin filename="gz-sim-joint-state-publisher-system" name="gz::sim::systems::JointStatePublisher">
        <joint_name>front_left_steer_joint</joint_name>
        <joint_name>front_left_wheel_joint</joint_name>

        <joint_name>front_right_steer_joint</joint_name>
        <joint_name>front_right_wheel_joint</joint_name>

        <joint_name>rear_left_steer_joint</joint_name>
        <joint_name>rear_left_wheel_joint</joint_name>

        <joint_name>rear_right_steer_joint</joint_name>
        <joint_name>rear_right_wheel_joint</joint_name>

      </plugin>
    </gazebo> 

</robot>
